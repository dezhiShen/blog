<html>

<head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <title>博客</title>
</head>

<body>
    <div id="app">
        <el-container>
            <el-aside>
                <div v-html="summary"></div>
            </el-aside>
            <el-main>
                <div v-html="content"></div>
            </el-main>
        </el-container>
        <div id="content"></div>
    </div>
</body>
<script>
    var vm = new Vue({
        el: "#app",
        name: "app",
        props: {},
        computed: {},
        data() {
            return {
                renderer: null,
                content: null,
                summary: null
            }
        },
        methods: {
            init: function () {
                this.initRender()
                this.renderSummary()
            },
            initRender: function () {
                this.renderer = new marked.Renderer();
                this.renderer.link = function (href, title, text) {
                    if (href.startWith("http")) {
                        return `<a href="${href}" target="_blank">${text}</a>`
                    } else {
                        return `<a href="#" onclick="renderContent('${href}')">${text}</a>`
                    }
                }
            },
            renderSummary: function () {
                this.renderFromUrl("./SUMMARY.md").then(
                    data => {
                        this.summary = data
                    }
                )
            },
            renderContent: function (url) {
                this.renderFromUrl(url).then(data => {
                    this.content = data
                })
            },
            renderFromUrl: function (url, node) {
                let instance = axios.create()
                return instance.get(url).then(res => {
                    return marked(res.data, { renderer: this.renderer })
                })
            }
        },

        mounted: async function () {
            window.renderContent = this.renderContent;
            this.init()
        }
    });
</script>

</html>